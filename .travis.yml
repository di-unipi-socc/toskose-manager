sudo: required

dist: xenial   # required for Python >= 3.7
language: python
python:
  - "3.7"
  - "3.7.1"

services:
  - docker
  # docker-compose is pre-installed with Docker service

install:
  - pip install -r requirements.txt

script:
  - pytest

after_success:
  - docker --version
  - export VERSION=$(python -c "import app; print(app.__version__)")
  - export IMAGE_NAME=diunipisocc/toskose-manager
  - |
    docker build \
    --build-arg APP_VERSION=${VERSION} \
    -t $IMAGE_NAME:${VERSION} \
    -t $IMAGE_NAME:latest \
    .
  - echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
  - docker push $IMAGE_NAME